{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8">
    <!-- Main Container with gradient background -->
    <div class="bg-gradient-to-br from-light to-white rounded-3xl shadow-2xl overflow-hidden border border-gray-200">
        <!-- Top Section - Instructions -->
        <div class="bg-gradient-to-r from-primary-600 to-primary-500 p-8">
            <div class="max-w-3xl mx-auto text-center">
                <h1 class="text-white text-4xl font-bold mb-4 flex items-center justify-center gap-3">
                    <span class="p-2 bg-white/10 rounded-lg">
                        <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/>
                        </svg>
                    </span>
                    Speech to Sign Language
                </h1>
                <p class="text-primary-50 text-lg">Transform your words into visual sign language</p>
            </div>
        </div>

        <div class="flex flex-col lg:flex-row">
            <!-- Left Section -->
            <div class="w-full lg:w-1/2 p-8">
                <div class="glass rounded-2xl p-8 shadow-lg">
                    <h2 class="text-2xl font-bold text-secondary-800 mb-6 flex items-center">
                        <span class="w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center mr-3">
                            <svg class="w-6 h-6 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                            </svg>
                        </span>
                        Voice Input
                    </h2>
                    
                    <form action="" method="post" class="space-y-6">
                        {% csrf_token %}
                        <div class="relative group">
                            <input type="text" 
                                   name="sen" 
                                   id="speechToText" 
                                   class="form-input pr-12"
                                   placeholder="Type or speak your message..."
                                   aria-label="Enter text to convert">
                            <button type="button" 
                                    onclick="record()" 
                                    class="absolute right-2 top-1/2 transform -translate-y-1/2 p-3 bg-primary-50 text-primary-600 rounded-full hover:bg-primary-100 group-hover:scale-105 transition-all duration-300"
                                    aria-label="Start voice input">
                                <img src="{% static 'mic3.png' %}" alt="Microphone" class="h-6 w-6">
                            </button>
                        </div>
                        <button type="submit" 
                                name="submit" 
                                class="btn-primary w-full">
                            <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                            </svg>
                            Convert to Sign Language
                        </button>
                    </form>

                    {% if text or words %}
                    <div class="mt-8 space-y-6">
                        {% if text %}
                        <div class="bg-white rounded-xl p-6 shadow-md border-l-4 border-accent-500">
                            <h3 class="text-secondary-800 font-bold mb-2 flex items-center">
                                <span class="w-8 h-8 rounded-full bg-accent-100 flex items-center justify-center mr-2">
                                    <svg class="w-5 h-5 text-accent-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"/>
                                    </svg>
                                </span>
                                Your Input
                            </h3>
                            <p class="text-secondary-700 text-lg">{{ text }}</p>
                        </div>
                        {% endif %}

                        {% if words %}
                        <div class="bg-white rounded-xl p-6 shadow-md border-l-4 border-primary-500">
                            <h3 class="text-secondary-800 font-bold mb-4 flex items-center">
                                <span class="w-8 h-8 rounded-full bg-primary-100 flex items-center justify-center mr-2">
                                    <svg class="w-5 h-5 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/>
                                    </svg>
                                </span>
                                Key Words
                            </h3>
                            <ul id="list" class="flex flex-wrap gap-3">
                                {% for word in words %}
                                <li id="{{ i }}" 
                                    class="px-4 py-2 bg-primary-50 text-primary-700 rounded-full transition-all duration-300 hover:bg-primary-100 hover:text-primary-800 cursor-pointer text-lg font-medium transform hover:-translate-y-1 hover:shadow-md">
                                    {{ word }}
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Right Section -->
            <div class="w-full lg:w-1/2 p-8">
                <div class="glass rounded-2xl p-8 shadow-lg">
                    <h2 class="text-2xl font-bold text-secondary-800 mb-6 flex items-center">
                        <span class="w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center mr-3">
                            <svg class="w-6 h-6 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                            </svg>
                        </span>
                        Sign Language Animation
                    </h2>
                    
                    <div class="space-y-6">
                        <button onclick="playPause()" 
                                class="btn-primary w-full">
                            <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                            </svg>
                            Play/Pause Animation
                        </button>

                        <div class="relative rounded-xl overflow-hidden shadow-2xl bg-secondary-900 aspect-video group">
                            <div class="absolute inset-0 bg-gradient-to-t from-secondary-900/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            <video id="videoPlayer" 
                                   class="w-full h-full"
                                   preload="auto"
                                   aria-label="Sign language animation player">
                                <source src="" type="video/mp4">
                                Your browser does not support HTML5 video.
                            </video>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Enhanced JavaScript with better feedback
    function record() {
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        const micButton = document.querySelector('button[onclick="record()"]');
        const input = document.getElementById('speechToText');
        
        recognition.lang = 'en-IN';
        
        // Visual feedback
        micButton.classList.add('bg-red-500');
        micButton.setAttribute('aria-label', 'Recording...');
        input.placeholder = 'Listening...';
        
        recognition.onresult = function(event) {
            input.value = event.results[0][0].transcript;
            resetRecordingState();
        };
        
        recognition.onerror = function(event) {
            resetRecordingState();
            input.placeholder = 'Error: ' + event.error;
        };
        
        recognition.onend = function() {
            resetRecordingState();
        };
        
        function resetRecordingState() {
            micButton.classList.remove('bg-red-500');
            micButton.setAttribute('aria-label', 'Start voice input');
            input.placeholder = 'Type or speak your message...';
        }
        
        recognition.start();
    }

    // Video Playback Functions
    let videoSource = [];
    let currentVideoIndex = 0;
    let isPlaying = false;

    function play() {
        const listElement = document.getElementById("list");
        if (!listElement) return;

        const videos = listElement.getElementsByTagName("li");
        videoSource = [];

        // Get video sources
        for (let j = 0; j < videos.length; j++) {
            videoSource[j] = "/static/" + videos[j].innerHTML.trim() + ".mp4";
        }

        function videoPlay(videoNum) {
            // Reset all word styles
            Array.from(videos).forEach(li => {
                li.classList.remove('bg-primary', 'text-secondary', 'scale-110');
                li.classList.add('bg-gray-100');
            });

            // Highlight current word
            videos[videoNum].classList.remove('bg-gray-100');
            videos[videoNum].classList.add('bg-primary', 'text-secondary', 'scale-110');

            // Play video
            const videoPlayer = document.getElementById("videoPlayer");
            videoPlayer.src = videoSource[videoNum];
            videoPlayer.load();
            videoPlayer.play();
        }

        // Handle video end event
        const videoPlayer = document.getElementById("videoPlayer");
        videoPlayer.addEventListener('ended', function myHandler() {
            currentVideoIndex++;
            if (currentVideoIndex >= videos.length) {
                currentVideoIndex = 0;
                isPlaying = false;
                return;
            }
            videoPlay(currentVideoIndex);
        });

        // Start playing from beginning
        currentVideoIndex = 0;
        videoPlay(currentVideoIndex);
        isPlaying = true;
    }

    function playPause() {
        const videoPlayer = document.getElementById("videoPlayer");
        const playPauseButton = document.querySelector('button[onclick="playPause()"]');
        
        if (!isPlaying) {
            play();
            playPauseButton.innerHTML = `
                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                Pause Animation
            `;
        } else {
            videoPlayer.pause();
            playPauseButton.innerHTML = `
                <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                </svg>
                Play Animation
            `;
        }
        isPlaying = !isPlaying;
    }

    // Initialize video player state
    document.addEventListener('DOMContentLoaded', function() {
        const videoPlayer = document.getElementById("videoPlayer");
        if (videoPlayer) {
            videoPlayer.addEventListener('play', function() {
                isPlaying = true;
            });
            videoPlayer.addEventListener('pause', function() {
                isPlaying = false;
            });
        }
    });
</script>
{% endblock %}

<style>
    /* Container Styles */
    .content-container {
        background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
        border-radius: 1.5rem;
        padding: 2rem;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }

    /* Input Section */
    .input-section {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 1rem;
        padding: 2rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    /* Video Player */
    .video-container {
        background: #0f172a;
        border-radius: 1rem;
        overflow: hidden;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }

    /* Word Pills */
    .word-pill {
        background: #e0f2fe;
        color: #0284c7;
        padding: 0.5rem 1rem;
        border-radius: 9999px;
        font-weight: 500;
        transition: all 0.3s;
    }

    .word-pill:hover {
        background: #0ea5e9;
        color: white;
        transform: translateY(-2px);
    }

    /* Active Word */
    .word-pill.active {
        background: #0284c7;
        color: white;
        box-shadow: 0 4px 6px -1px rgba(2, 132, 199, 0.2);
    }

    /* Microphone Button */
    .mic-button {
        background: linear-gradient(135deg, #0ea5e9, #0284c7);
        color: white;
        padding: 0.75rem;
        border-radius: 9999px;
        transition: all 0.3s;
    }

    .mic-button:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 6px -1px rgba(2, 132, 199, 0.2);
    }

    .mic-button.recording {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        animation: pulse 1.5s infinite;
    }
</style>
